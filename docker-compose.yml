version: '2'
services:
  db:
    image: mysql:latest
    ports:
      - "3306:3306"
    privileged: true
    environment:
      - MYSQL_ALLOW_EMPTY_PASSWORD=yes

  data:
    build: ./docker-laravel-data
    image: docker-laravel-data
    volumes:
      - ~/Code/myapp:/data:rw
    privileged: true

  phpfpm:
    build: ./docker-laravel-phpfpm
    image: docker-laravel-phpfpm
    volumes_from:
      - data
    links:
      - db
    privileged: true
    environment:
      XDEBUG_REMOTE_HOST: 192.168.3.104
      XDEBUG_IDEKEY: PHPSTORM

  web:
    build: ./docker-laravel-nginx
    image: docker-laravel-nginx
    volumes_from:
      - data
    links:
      - phpfpm
    ports:
      - "80:80"
    privileged: true
    depends_on:
      - db
      - phpfpm

  composer:
    build: ./docker-laravel-composer
    image: docker-laravel-composer
    volumes_from:
      - data

  phpcli:
    build: ./docker-phpcli
    image: docker-phpcli

  artisan:
    build: ./docker-laravel-artisan
    image: docker-laravel-artisan
    volumes_from:
      - data
    links:
      - db
    depends_on:
      - phpcli

  bower:
    build: ./docker-laravel-bower
    image: docker-laravel-bower
    volumes_from:
      - data

  phpunit:
    build: ./docker-laravel-phpunit
    image: docker-laravel-phpunit
    volumes_from:
      - data
    depends_on:
      - phpcli